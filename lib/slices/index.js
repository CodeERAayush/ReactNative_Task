var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:true});exports.fetchProducts=exports.fetchProductById=exports.default=exports.addProduct=void 0;var _asyncToGenerator2=_interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));var _toolkit=require("@reduxjs/toolkit");var _offlineStorage=require("../utils/offlineStorage");var FakeStoreApi=require('fake_store_api');var api=new FakeStoreApi.DefaultApi();var fetchProducts=exports.fetchProducts=(0,_toolkit.createAsyncThunk)('https://fakestoreapi.com/products',function(){var _ref2=(0,_asyncToGenerator2.default)(function*(_,_ref){var rejectWithValue=_ref.rejectWithValue;try{var response=yield api.productsGet();yield(0,_offlineStorage.saveData)('products',response);return response;}catch(error){var cachedData=yield(0,_offlineStorage.loadData)('products');if(cachedData){return cachedData;}return rejectWithValue(error.message);}});return function(_x,_x2){return _ref2.apply(this,arguments);};}());var fetchProductById=exports.fetchProductById=(0,_toolkit.createAsyncThunk)('data/fetchProductById',function(){var _ref4=(0,_asyncToGenerator2.default)(function*(id,_ref3){var rejectWithValue=_ref3.rejectWithValue;try{var response=yield api.productsIdGet(id);return response;}catch(error){return rejectWithValue(error.message);}});return function(_x3,_x4){return _ref4.apply(this,arguments);};}());var addProduct=exports.addProduct=(0,_toolkit.createAsyncThunk)('data/addProduct',function(){var _ref6=(0,_asyncToGenerator2.default)(function*(newProduct,_ref5){var rejectWithValue=_ref5.rejectWithValue;try{var mockResponse=Object.assign({},newProduct,{id:Date.now(),rating:{rate:0,count:0}});return mockResponse;}catch(error){return rejectWithValue(error.message);}});return function(_x5,_x6){return _ref6.apply(this,arguments);};}());var dataSlice=(0,_toolkit.createSlice)({name:'data',initialState:{products:[],currentProduct:null,status:'idle',error:null},reducers:{},extraReducers:function extraReducers(builder){builder.addCase(fetchProducts.pending,function(state){state.status='loading';}).addCase(fetchProducts.fulfilled,function(state,action){state.status='succeeded';state.products=action.payload;}).addCase(fetchProducts.rejected,function(state,action){state.status='failed';state.error=action.payload;}).addCase(fetchProductById.pending,function(state){state.status='loading';}).addCase(fetchProductById.fulfilled,function(state,action){state.status='succeeded';state.currentProduct=action.payload;}).addCase(fetchProductById.rejected,function(state,action){state.status='failed';state.error=action.payload;}).addCase(addProduct.pending,function(state){state.status='loading';}).addCase(addProduct.fulfilled,function(state,action){state.status='succeeded';state.products.unshift(action.payload);}).addCase(addProduct.rejected,function(state,action){state.status='failed';state.error=action.payload;});}});var _default=exports.default=dataSlice.reducer;